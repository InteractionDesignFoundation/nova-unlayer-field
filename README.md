# Nova Unlayer Field

![image](https://user-images.githubusercontent.com/5278175/144930172-1bf257ee-54a6-4c88-a3a8-772a1d687677.png)

[![Latest Stable Version](https://poser.pugx.org/interaction-design-foundation/nova-unlayer-field/v)](https://packagist.org/packages/interaction-design-foundation/nova-unlayer-field)
[![Total Downloads](https://poser.pugx.org/interaction-design-foundation/nova-unlayer-field/downloads)](https://packagist.org/packages/interaction-design-foundation/nova-unlayer-field)
[![License](https://poser.pugx.org/interaction-design-foundation/nova-unlayer-field/license)](https://packagist.org/packages/interaction-design-foundation/nova-unlayer-field)

Adds a Laravel Nova field for Unlayer to compose emails and landing pages.

![image](https://github.com/InteractionDesignFoundation/nova-unlayer-field/blob/main/resources/img/demo-800x592@8.gif)



## Installation

You can install the package in to a Laravel app that uses [Nova](https://nova.laravel.com) via composer:

```bash
composer require interaction-design-foundation/nova-unlayer-field
```

⚠️ For PHP 7.1 - PHP 7.4 please use [version 0.2.2](https://github.com/InteractionDesignFoundation/nova-unlayer-field/tree/0.2.2) (it uses another namespace).


### Optional: publish the configuration

Run this on the command line from the root of your project:
```sh
php artisan vendor:publish --provider="InteractionDesignFoundation\NovaUnlayerField\ServiceProvider" --tag=config
```


## Usage

This package assumes that your Model has an attribute to store Unlayer design config JSON string
(it’s better to use `json` or `jsonb` or `longtext` SQL type to store it).

On submit, the package automatically stores Unlayer design config only (JSON string).
Most likely, you also want to do something with the output HTML code, generated by Unlayer.
To access it, please use `savingCallback()` method (see an extended example below).

Basic field config:

```php
use InteractionDesignFoundation\NovaUnlayerField\Unlayer;

public function fields()
{
    return [
        Unlayer::make('Content', 'design')->config([
            'projectId' => config('unlayer.project_id'),

            // optional
            'templateId' => config('unlayer.default_template_id'), // Used only if bound attribute ('design' in this case) is empty.
            'displayMode' => 'web', // "email" or "web". Default value: "email"
            'locale' => 'es', // Locale for Unlayer UI. Default value: application’s locale.
        ]),
     ];
}
```


### Options
 - `->config(array|callable $config)`: Specify [Unlayer config](https://docs.unlayer.com/docs/getting-started#section-configuration-options).
 - `->height(string $height)`: Set height of the editor (with units). E.g. '1000px' (800px by default).
 - `->savingCallback(?callable $callback)`: Specify a callback to call on before Model saving. Useful to store generated HTML code (to a Model or as a file).

Example of using `savingCallback`:
```php
Unlayer::make('Design')->config([
        'projectId' => config('unlayer.project_id'),
    ])
    ->savingCallback(function (NovaRequest $request, $attribute, Newsletter $newsletterModel, $outputHtmlFieldName) {
        // set output HTML to your model (Newsletter in this case)
        // No need to call $model->save() — Nova will do it down the road.
        $newsletterModel->html = $request->input($outputHtmlFieldName);
    }),
```


### Changelog

Please see [Releases](https://github.com/InteractionDesignFoundation/nova-unlayer-field/releases) for more information on what has changed recently.


## Contributing

Please see [CONTRIBUTING](CONTRIBUTING.md) for details.


## License

The MIT License (MIT). Please see [License File](LICENSE) for more information.
